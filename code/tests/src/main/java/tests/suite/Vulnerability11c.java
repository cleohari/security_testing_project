package tests.suite;

import net.sourceforge.jwebunit.junit.WebTester;
import org.junit.After;
import org.junit.Before;
import org.junit.Test;
import tests.utilities.Helper;

/**
 * Proof of concept for the XSS vulnerability #11.c.
 * <input type='hidden' name='page' value='$page'>
 *
 * @author Davide Pedranz
 */
public final class Vulnerability11c {

    private WebTester tester;
    private Helper helper;

    @Before
    public void prepare() {
        tester = new WebTester();
        tester.setBaseUrl(Helper.BASE_URL);
        helper = new Helper(tester);
    }

    @Test
    public void test() {

        // this vulnerability is on a page dedicated to a teacher
        helper.loginAsTeacher();

        // move to the page to set a new assignment (vulnerable form)
        tester.clickLinkWithText("course");
        tester.assertMatch("Class Settings");
        tester.clickLinkWithText("Assignments");
        tester.assertMatch("Manage Assignments");

        // tamper the variable $page2
        tester.setWorkingForm("assignments");
        tester.setHiddenField("page", "2 '> <script>alert('xss')</script> <span id='xss");
        helper.addSubmitButton("assignments");
        tester.submit();

        // check if the XSS was successful
        tester.assertMatch("Add New Assignment");
        tester.assertNoMatch("<script>alert('xss')</script>");
    }

    @After
    public void cleanup() {
        // no-op, nothing to cleanup
    }
}
